<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SK Santisima Cruz IMS</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script defer src="{{ url_for('static', filename='script.js') }}"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <!-- Global Background Styles -->
  <style>
    body {
      background: linear-gradient(rgba(248, 249, 250, 0.92), rgba(255, 255, 255, 0.95)), 
                  url("{{ url_for('static', filename='dashbg.jpg') }}");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      min-height: 100vh;
      margin: 0;
      font-family: 'Poppins', sans-serif;
    }

    /* Make cards slightly transparent to show background */
    .card, .stat-card {
      background: rgba(255, 255, 255, 0.97);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Ensure tables have proper background */
    .table {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(5px);
    }

    /* Make sure flash messages are visible */
    .flash-container {
      position: relative;
      z-index: 1000;
    }

    /* Ensure main content area has proper spacing */
    #main-content {
      position: relative;
      z-index: 1;
    }

    /* Login and homepage exceptions */
    body.login-page {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    /* HOMEPAGE NOW USES THE SAME DASHBG.JPG AS OTHER PAGES */
    body.homepage {
      background: linear-gradient(rgba(248, 249, 250, 0.92), rgba(255, 255, 255, 0.95)), 
                  url("{{ url_for('static', filename='dashbg.jpg') }}");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
    }

    /* Enhanced Topbar Styles */
    .topbar {
      background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
      padding: 0 25px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .menu-btn {
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 10px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .menu-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo img {
      height: 40px;
      width: auto;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .logo-text h1 {
      color: white;
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      line-height: 1.2;
    }

    .logo-subtitle {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.8rem;
      font-weight: 400;
      display: block;
    }

    .topbar-right {
      display: flex;
      align-items: center;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
    }

    .user-info:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-1px);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .user-details {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .user-name {
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      line-height: 1;
    }

    .user-role {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: capitalize;
    }

    .user-actions {
      display: flex;
      align-items: center;
    }

    .logout-link {
      color: rgba(255, 255, 255, 0.8);
      padding: 8px;
      border-radius: 6px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logout-link:hover {
      color: white;
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-1px);
    }

    .login-btn {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .login-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 255, 255, 0.2);
      color: white;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .topbar {
        padding: 0 15px;
        height: 60px;
      }
      
      .logo-text h1 {
        font-size: 1.1rem;
      }
      
      .logo-subtitle {
        font-size: 0.7rem;
      }
      
      .user-details {
        display: none;
      }
      
      .user-info {
        padding: 8px;
      }
    }

    @media (max-width: 480px) {
      .logo-text {
        display: none;
      }
      
      .topbar-left {
        gap: 10px;
      }
    }
  </style>
  
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      lucide.createIcons();
    });
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="{% if body_class %}{{ body_class }}{% elif request.endpoint == 'index' %}homepage{% else %}default-page{% endif %}">

  {# Topbar & sidebar hidden only on login page #}
  {% if not (body_class is defined and body_class == 'login-page') %}
  <header class="topbar" role="banner">
    <!-- Left section with menu and logo -->
    <div class="topbar-left">
      <button id="menu-toggle" class="menu-btn" aria-label="Open menu">
        <i data-lucide="menu"></i>
      </button>

      <!-- logo -->
      <div class="logo">
        <img src="{{ url_for('static', filename='sk.png') }}" alt="SK Logo">
        <div class="logo-text">
          <h1>SK Santisima Cruz IMS</h1>
          <span class="logo-subtitle">Information Management System</span>
        </div>
      </div>
    </div>

    <!-- Right section with user info -->
    <div class="topbar-right">
      {% if session.user %}
      <div class="user-info">
        <div class="user-avatar">
          <i data-lucide="user" style="width:20px;height:20px;"></i>
        </div>
        <div class="user-details">
          <span class="user-name">{{ session.user.fullname }}</span>
          <span class="user-role">{{ session.user.role|replace('_', ' ') }}</span>
        </div>
        <div class="user-actions">
          <a href="{{ url_for('logout') }}" class="logout-link" title="Logout">
            <i data-lucide="log-out" style="width:18px;height:18px;"></i>
          </a>
        </div>
      </div>
      {% else %}
      <a href="{{ url_for('login') }}" class="login-btn">
        <i data-lucide="log-in" style="width:16px;height:16px;"></i>
        Login
      </a>
      {% endif %}
    </div>
  </header>

  <!-- Sidebar -->
  <div id="sidebar" class="sidebar {% if request.endpoint == 'index' %}hidden{% endif %}" aria-hidden="true">
    <nav>
      {% if session.user %}
        <!-- Dashboard links based on role -->
        {% if session.user.role == 'super_admin' %}
        <a href="{{ url_for('superadmin_dashboard') }}" class="nav-item">
          <i data-lucide="layout-dashboard"></i>
          <span class="nav-label">Dashboard</span>
        </a>
        {% elif session.user.role == 'SK_Chairman' %}
        <a href="{{ url_for('sk_chairman_dashboard') }}" class="nav-item">
          <i data-lucide="layout-dashboard"></i>
          <span class="nav-label">Dashboard</span>
        </a>
        {% elif session.user.role == 'Secretary' %}
        <a href="{{ url_for('secretary_dashboard') }}" class="nav-item">
          <i data-lucide="layout-dashboard"></i>
          <span class="nav-label">Dashboard</span>
        </a>
        {% elif session.user.role == 'Treasurer' %}
        <a href="{{ url_for('treasurer_dashboard') }}" class="nav-item">
          <i data-lucide="layout-dashboard"></i>
          <span class="nav-label">Dashboard</span>
        </a>
        {% elif session.user.role == 'BMO' %}
        <a href="{{ url_for('bmo_dashboard') }}" class="nav-item">
          <i data-lucide="layout-dashboard"></i>
          <span class="nav-label">Dashboard</span>
        </a>
        {% endif %}
        
        <!-- Add icons to your sidebar links -->
        <a href="{{ url_for('projects') }}" class="nav-item">
          <i data-lucide="folder"></i>
          <span class="nav-label">Projects</span>
        </a>
        <a href="{{ url_for('logbook') }}" class="nav-item">
          <i data-lucide="book"></i>
          <span class="nav-label">Logbook</span>
        </a>
        <a href="{{ url_for('reports') }}" class="nav-item">
          <i data-lucide="file-text"></i>
          <span class="nav-label">Reports</span>
        </a>
        <!-- Add this line in the sidebar -->
        <a href="{{ url_for('budgets') }}" class="nav-item">
            <i data-lucide="credit-card"></i>
            <span class="nav-label">Budgets</span>
        </a>
        <!-- Add role-based links if needed -->
        {% if session.user.role == 'super_admin' %}
        <a href="{{ url_for('user_management') }}" class="nav-item">
          <i data-lucide="settings"></i>
          <span class="nav-label">User Management</span>
        </a>
        {% endif %}
        
      {% else %}
        <a href="{{ url_for('login') }}" class="nav-item">Login</a>
      {% endif %}
    </nav>
  </div>
  <div class="sidebar-overlay"></div>
  {% endif %}

  <!-- Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-container">
        {% for cat, msg in messages %}
          <div class="flash {{ cat }}">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Main -->
  <main id="main-content">
    {% block content %}{% endblock %}
  </main>

  {% if not (body_class is defined and body_class == 'login-page') %}
  <footer class="footer">Made with ❤️ by SK Santisima Cruz | Santa Cruz, Laguna</footer>
  {% endif %}

</body>
</html>